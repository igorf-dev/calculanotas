<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalculaNotas - Descubra sua M√©dia Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            box-sizing: border-box;
        }
        
        html {
            overflow-x: hidden;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }
        
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .glass-card-dark {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modern-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .modern-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .modern-btn:hover::before {
            left: 100%;
        }
        
        .modern-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -12px rgba(102, 126, 234, 0.4);
        }
        
        .modern-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modern-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 10px 25px -5px rgba(102, 126, 234, 0.2);
        }
        
        .floating-card {
            animation: floatCard 6s ease-in-out infinite;
        }
        
        @keyframes floatCard {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(0.5deg); }
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        .level-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .level-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.2);
        }
        
        .subject-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .subject-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }
        
        .modern-header {
            background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .icon-glow {
            filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5));
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .8; }
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .modern-footer {
            background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.9) 100%);
            backdrop-filter: blur(20px);
        }
        
        .chart-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white !important;
                color: black !important;
            }
            
            .gradient-bg {
                background: white !important;
            }
            
            .glass-card-dark {
                background: white !important;
                color: black !important;
                border: 2px solid #e5e7eb !important;
            }
            
            .chart-container {
                background: white !important;
                border: 2px solid #e5e7eb !important;
            }
            
            .text-white {
                color: black !important;
            }
            
            .text-gray-300, .text-gray-400 {
                color: #6b7280 !important;
            }
            
            .bg-gradient-to-r, .bg-gradient-to-br {
                background: #f3f4f6 !important;
                color: black !important;
            }
            
            .modern-header, .modern-footer {
                display: none !important;
            }
            
            .print-hide {
                display: none !important;
            }
            
            .print-show {
                display: block !important;
            }
            
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 2rem;
                padding: 1rem;
                border-bottom: 2px solid #e5e7eb;
            }
            
            .print-page-break {
                page-break-before: always;
            }
            
            .chart-container {
                break-inside: avoid;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Modern Header -->
    <header class="modern-header sticky top-0 z-40">
        <div class="container mx-auto px-4 sm:px-6 py-6 max-w-full">
            <div class="text-xs text-gray-300 mb-4 opacity-80">
                Cria√ß√£o: Prof. Igor ‚Äì Geografia e Tecnologia e Inova√ß√£o
            </div>
            
            <div class="flex items-center justify-center mb-6">
                <div class="flex items-center space-x-4">
                    <div class="bg-gradient-to-br from-blue-400 to-purple-600 p-4 rounded-2xl icon-glow pulse-animation">
                        <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <h1 class="text-5xl font-black text-white tracking-tight">CalculaNotas</h1>
                </div>
            </div>
            
            <div class="flex items-center justify-between mb-6">
                <div class="flex-1"></div>
                <h2 class="text-3xl font-bold text-center text-white">Descubra sua M√©dia Final</h2>
                <div class="flex-1 flex justify-end space-x-4">
                    <button id="saveDataBtn" class="modern-btn text-white px-6 py-3 rounded-xl font-semibold flex items-center space-x-2 text-sm shadow-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <span>Salvar Dados</span>
                    </button>
                    <button id="showChartsBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-3 rounded-xl font-semibold flex items-center space-x-2 text-sm shadow-lg transition-all duration-300 hover:scale-105">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span>Ver Gr√°ficos</span>
                    </button>
                </div>
            </div>
            
            <p class="text-center text-xl text-gray-200 max-w-4xl mx-auto leading-relaxed font-light">
                Organize seus estudos, trace metas e acompanhe sua evolu√ß√£o escolar ao longo do ano.
            </p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 py-12 relative z-10 max-w-full">
        <!-- Student Info Card -->
        <div class="glass-card rounded-3xl p-8 mb-8 floating-card">
            <div class="flex items-center mb-8">
                <div class="bg-gradient-to-br from-green-400 to-emerald-600 p-4 rounded-2xl mr-6 icon-glow">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-gradient">Dados do Aluno</h2>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Nome Completo</label>
                    <input type="text" id="studentName" class="modern-input w-full px-6 py-4 rounded-2xl text-lg font-medium" placeholder="Digite seu nome completo">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">S√©rie/Turma</label>
                    <input type="text" id="studentClass" class="modern-input w-full px-6 py-4 rounded-2xl text-lg font-medium" placeholder="Ex: 1¬∫ Ano A">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Projeto de Vida</label>
                    <input type="text" id="lifeProject" class="modern-input w-full px-6 py-4 rounded-2xl text-lg font-medium" placeholder="Descreva brevemente seus objetivos...">
                </div>
            </div>
        </div>

        <!-- Subjects Card -->
        <div class="glass-card rounded-3xl p-8 mb-8 floating-card">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center">
                    <div class="bg-gradient-to-br from-blue-400 to-indigo-600 p-4 rounded-2xl mr-6 icon-glow">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                    </div>
                    <h2 class="text-3xl font-bold text-gradient">Disciplinas e Notas</h2>
                </div>
                <button id="addSubjectBtn" class="bg-gradient-to-r from-green-400 to-emerald-600 hover:from-green-500 hover:to-emerald-700 text-white px-8 py-4 rounded-2xl font-bold flex items-center space-x-3 shadow-lg transition-all duration-300 hover:scale-105 neon-glow">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span>Adicionar Mat√©ria</span>
                </button>
            </div>
            
            <div id="subjectsContainer" class="space-y-6">
                <!-- Subjects will be added here -->
            </div>
        </div>

        <!-- Proficiency Levels -->
        <div class="glass-card rounded-3xl p-8 mb-8 floating-card">
            <div class="flex items-center mb-8">
                <div class="bg-gradient-to-br from-yellow-400 to-orange-600 p-4 rounded-2xl mr-6 icon-glow">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-gradient">N√≠veis de Profici√™ncia</h2>
            </div>
            
            <div class="grid md:grid-cols-4 gap-6">
                <div class="level-card border-l-4 border-red-500 p-6 rounded-2xl">
                    <div class="flex items-center">
                        <div class="text-4xl mr-4">üòû</div>
                        <div>
                            <h3 class="font-bold text-red-800 text-lg">Abaixo do B√°sico</h3>
                            <p class="text-sm text-red-600 font-semibold">0% - 49,9%</p>
                        </div>
                    </div>
                </div>
                
                <div class="level-card border-l-4 border-orange-500 p-6 rounded-2xl">
                    <div class="flex items-center">
                        <div class="text-4xl mr-4">üòê</div>
                        <div>
                            <h3 class="font-bold text-orange-800 text-lg">B√°sico</h3>
                            <p class="text-sm text-orange-600 font-semibold">50% - 69%</p>
                        </div>
                    </div>
                </div>
                
                <div class="level-card border-l-4 border-yellow-500 p-6 rounded-2xl">
                    <div class="flex items-center">
                        <div class="text-4xl mr-4">üòä</div>
                        <div>
                            <h3 class="font-bold text-yellow-800 text-lg">Adequado</h3>
                            <p class="text-sm text-yellow-600 font-semibold">70% - 79,9%</p>
                        </div>
                    </div>
                </div>
                
                <div class="level-card border-l-4 border-green-500 p-6 rounded-2xl">
                    <div class="flex items-center">
                        <div class="text-4xl mr-4">üéâ</div>
                        <div>
                            <h3 class="font-bold text-green-800 text-lg">Avan√ßado</h3>
                            <p class="text-sm text-green-600 font-semibold">80% - 100%</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modern Footer -->
    <footer class="modern-footer text-white py-12">
        <div class="container mx-auto px-4 sm:px-6 max-w-full">
            <div class="flex items-center justify-center mb-8">
                <div class="bg-gradient-to-br from-blue-400 to-purple-600 p-3 rounded-2xl mr-4 icon-glow">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold">Como Funciona</h3>
            </div>
            <p class="text-center text-gray-300 max-w-5xl mx-auto leading-relaxed text-xl font-light">
                Fa√ßa simula√ß√µes das suas m√©dias bimestrais em cada disciplina e descubra como est√° o seu desempenho ao longo do ano. Com esta calculadora online, voc√™ pode adicionar as notas de todas as mat√©rias, visualizar a m√©dia final e entender melhor seu progresso escolar. Assim, fica mais f√°cil organizar os estudos, tra√ßar metas e buscar melhorias onde for necess√°rio.
            </p>
            <div class="text-center mt-8 text-sm text-gray-400 font-semibold">
                EE PEI Orlando Signorelli ‚Äì Campinas/SP
            </div>
        </div>
    </footer>

    <!-- Modern Charts Modal -->
    <div id="chartsModal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 backdrop-blur-sm overflow-y-auto">
        <div class="min-h-screen flex items-start justify-center p-4 py-8">
            <div class="glass-card-dark rounded-3xl max-w-7xl w-full overflow-visible">
                <!-- Print Header (hidden on screen, visible on print) -->
                <div class="print-header hidden">
                    <h1 class="text-3xl font-bold mb-2">CalculaNotas - Relat√≥rio de Desempenho</h1>
                    <p class="text-lg">EE PEI Orlando Signorelli ‚Äì Campinas/SP</p>
                    <p class="text-sm">Prof. Igor ‚Äì Geografia e Tecnologia e Inova√ß√£o</p>
                    <p class="text-sm mt-2">Data: <span id="printDate"></span></p>
                </div>
                
                <div class="p-8 border-b border-gray-700 print-hide">
                    <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="bg-gradient-to-br from-purple-400 to-pink-600 p-4 rounded-2xl mr-6 icon-glow">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <h2 class="text-3xl font-bold text-white">An√°lise de Desempenho</h2>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button id="printReportBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-3 rounded-2xl font-semibold flex items-center space-x-2 text-sm shadow-lg transition-all duration-300 hover:scale-105">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                            </svg>
                            <span>Imprimir</span>
                        </button>
                        <button id="savePdfBtn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-3 rounded-2xl font-semibold flex items-center space-x-2 text-sm shadow-lg transition-all duration-300 hover:scale-105">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span>Salvar PDF</span>
                        </button>
                        <button id="closeChartsBtn" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white p-3 rounded-2xl transition-all duration-300 hover:scale-105">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                        </div>
                    </div>
                </div>
            
            <div class="p-8">
                <!-- Student Summary -->
                <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-3xl p-8 mb-10 border border-white/10">
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="text-center">
                            <div class="text-4xl font-black text-blue-400" id="chartStudentName">-</div>
                            <div class="text-sm text-gray-400 font-semibold uppercase tracking-wide">Nome do Aluno</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-black text-purple-400" id="chartStudentClass">-</div>
                            <div class="text-sm text-gray-400 font-semibold uppercase tracking-wide">S√©rie/Turma</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-black text-green-400" id="chartOverallAverage">-</div>
                            <div class="text-sm text-gray-400 font-semibold uppercase tracking-wide">M√©dia Geral</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Container -->
                <div class="grid lg:grid-cols-2 gap-10">
                    <!-- Subjects Performance Chart -->
                    <div class="chart-container rounded-3xl p-8">
                        <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                            <div class="bg-gradient-to-br from-blue-400 to-indigo-600 p-3 rounded-2xl mr-4 icon-glow">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                            </div>
                            Desempenho Anual por Disciplina
                        </h3>
                        <div id="subjectsChart" class="h-80"></div>
                    </div>

                    <!-- Proficiency Distribution -->
                    <div class="chart-container rounded-3xl p-8">
                        <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                            <div class="bg-gradient-to-br from-green-400 to-emerald-600 p-3 rounded-2xl mr-4 icon-glow">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                </svg>
                            </div>
                            Distribui√ß√£o de N√≠veis
                        </h3>
                        <div id="proficiencyChart" class="h-80"></div>
                    </div>

                    <!-- Bimester Evolution -->
                    <div class="chart-container rounded-3xl p-8 lg:col-span-2">
                        <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                            <div class="bg-gradient-to-br from-orange-400 to-red-600 p-3 rounded-2xl mr-4 icon-glow">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                                </svg>
                            </div>
                            Evolu√ß√£o Geral por Bimestre
                        </h3>
                        <div id="evolutionChart" class="h-80"></div>
                    </div>
                </div>

                <!-- Individual Subject Charts -->
                <div class="mt-12">
                    <div id="individualChartsContainer" class="grid lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <!-- Individual charts will be generated here -->
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="mt-12 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-3xl p-8">
                    <h3 class="text-2xl font-bold text-yellow-300 mb-6 flex items-center">
                        <div class="bg-gradient-to-br from-yellow-400 to-orange-600 p-3 rounded-2xl mr-4 icon-glow">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                        </div>
                        Recomenda√ß√µes de Estudo
                    </h3>
                    <div id="recommendations" class="text-yellow-200">
                        <!-- Recommendations will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let subjectCount = 0;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            const addBtn = document.getElementById('addSubjectBtn');
            const saveBtn = document.getElementById('saveDataBtn');
            
            if (addBtn) {
                addBtn.addEventListener('click', addSubject);
            }
            
            if (saveBtn) {
                saveBtn.addEventListener('click', saveData);
            }
            
            const chartsBtn = document.getElementById('showChartsBtn');
            const closeChartsBtn = document.getElementById('closeChartsBtn');
            
            if (chartsBtn) {
                chartsBtn.addEventListener('click', showCharts);
            }
            
            if (closeChartsBtn) {
                closeChartsBtn.addEventListener('click', closeCharts);
            }
            
            const printBtn = document.getElementById('printReportBtn');
            const pdfBtn = document.getElementById('savePdfBtn');
            
            if (printBtn) {
                printBtn.addEventListener('click', printReport);
            }
            
            if (pdfBtn) {
                pdfBtn.addEventListener('click', savePDF);
            }
            
            // Load saved data if exists
            loadData();
            
            // Add first subject automatically if no data was loaded
            if (subjectCount === 0) {
                addSubject();
            }
        });

        function addSubject() {
            subjectCount++;
            
            const container = document.getElementById('subjectsContainer');
            if (!container) {
                return;
            }
            
            const subjectDiv = document.createElement('div');
            subjectDiv.className = 'subject-card rounded-3xl p-8 border border-gray-200';
            subjectDiv.id = `subject-${subjectCount}`;
            
            subjectDiv.innerHTML = `
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center flex-1 mr-6">
                        <div class="bg-gradient-to-br from-purple-400 to-indigo-600 p-3 rounded-2xl mr-4 icon-glow">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                            </svg>
                        </div>
                        <input type="text" placeholder="Nome da disciplina" class="modern-input flex-1 px-6 py-4 rounded-2xl text-xl font-semibold">
                    </div>
                    <button onclick="removeSubject(${subjectCount})" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white p-3 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">1¬∫ Bimestre</label>
                        <input type="number" min="0" max="10" step="0.1" placeholder="0.0" class="modern-input w-full px-4 py-4 rounded-2xl text-center text-xl font-bold" onchange="calculateAverage(${subjectCount})" oninput="updateBimesterLevel(${subjectCount}, 1, this.value)">
                        <div id="bimester-level-${subjectCount}-1" class="mt-3 px-3 py-2 rounded-xl text-xs font-bold text-center bg-gray-100 text-gray-500">
                            -
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">2¬∫ Bimestre</label>
                        <input type="number" min="0" max="10" step="0.1" placeholder="0.0" class="modern-input w-full px-4 py-4 rounded-2xl text-center text-xl font-bold" onchange="calculateAverage(${subjectCount})" oninput="updateBimesterLevel(${subjectCount}, 2, this.value)">
                        <div id="bimester-level-${subjectCount}-2" class="mt-3 px-3 py-2 rounded-xl text-xs font-bold text-center bg-gray-100 text-gray-500">
                            -
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">3¬∫ Bimestre</label>
                        <input type="number" min="0" max="10" step="0.1" placeholder="0.0" class="modern-input w-full px-4 py-4 rounded-2xl text-center text-xl font-bold" onchange="calculateAverage(${subjectCount})" oninput="updateBimesterLevel(${subjectCount}, 3, this.value)">
                        <div id="bimester-level-${subjectCount}-3" class="mt-3 px-3 py-2 rounded-xl text-xs font-bold text-center bg-gray-100 text-gray-500">
                            -
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">4¬∫ Bimestre</label>
                        <input type="number" min="0" max="10" step="0.1" placeholder="0.0" class="modern-input w-full px-4 py-4 rounded-2xl text-center text-xl font-bold" onchange="calculateAverage(${subjectCount})" oninput="updateBimesterLevel(${subjectCount}, 4, this.value)">
                        <div id="bimester-level-${subjectCount}-4" class="mt-3 px-3 py-2 rounded-xl text-xs font-bold text-center bg-gray-100 text-gray-500">
                            -
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl p-8 border-2 border-dashed border-gray-300">
                    <div class="flex items-center justify-between">
                        <span class="text-2xl font-bold text-gray-700">M√©dia Final:</span>
                        <div class="flex items-center space-x-6">
                            <span id="average-${subjectCount}" class="text-4xl font-black text-gray-800">-</span>
                            <div class="flex flex-col items-end space-y-2">
                                <div id="level-${subjectCount}" class="px-6 py-3 rounded-2xl text-sm font-bold bg-gray-200 text-gray-600">
                                    Aguardando notas
                                </div>
                                <div id="status-${subjectCount}" class="px-4 py-2 rounded-xl text-xs font-bold bg-gray-100 text-gray-500">
                                    -
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(subjectDiv);
        }

        function removeSubject(id) {
            const subject = document.getElementById(`subject-${id}`);
            if (subject) {
                subject.remove();
            }
        }

        function getProficiencyLevel(grade) {
            if (grade === '' || isNaN(grade) || grade < 0) {
                return { class: 'bg-gray-100 text-gray-500', text: '-' };
            }
            
            const percentage = (parseFloat(grade) / 10) * 100;
            
            if (percentage < 50) {
                return { class: 'bg-red-500 text-white', text: 'Abaixo do B√°sico <span class="text-lg">üòû</span>' };
            } else if (percentage < 70) {
                return { class: 'bg-orange-500 text-white', text: 'B√°sico <span class="text-lg">üòê</span>' };
            } else if (percentage < 80) {
                return { class: 'bg-yellow-500 text-white', text: 'Adequado <span class="text-lg">üòä</span>' };
            } else {
                return { class: 'bg-green-500 text-white', text: 'Avan√ßado <span class="text-lg">üéâ</span>' };
            }
        }

        function getApprovalStatus(grade, allGradesFilled) {
            if (grade === '' || isNaN(grade) || grade < 0 || !allGradesFilled) {
                return { class: 'bg-gray-100 text-gray-500', text: '-' };
            }
            
            const numericGrade = parseFloat(grade);
            
            if (numericGrade >= 5.0) {
                return { class: 'bg-green-600 text-white', text: '‚úÖ APROVADO' };
            } else {
                return { class: 'bg-red-600 text-white', text: '‚ùå REPROVADO' };
            }
        }

        function updateBimesterLevel(subjectId, bimester, value) {
            const levelElement = document.getElementById(`bimester-level-${subjectId}-${bimester}`);
            if (levelElement) {
                const level = getProficiencyLevel(value);
                levelElement.className = `mt-3 px-3 py-2 rounded-xl text-xs font-bold text-center ${level.class}`;
                levelElement.innerHTML = level.text;
            }
        }

        function calculateAverage(id) {
            const subject = document.getElementById(`subject-${id}`);
            if (!subject) return;
            
            const inputs = subject.querySelectorAll('input[type="number"]');
            let sum = 0;
            let hasAnyValue = false;
            let filledGrades = 0;
            
            inputs.forEach(input => {
                const value = parseFloat(input.value);
                if (!isNaN(value) && value >= 0 && input.value.trim() !== '') {
                    sum += value;
                    hasAnyValue = true;
                    filledGrades++;
                } else {
                    sum += 0;
                }
            });
            
            const averageElement = document.getElementById(`average-${id}`);
            const levelElement = document.getElementById(`level-${id}`);
            const statusElement = document.getElementById(`status-${id}`);
            
            if (averageElement && levelElement && statusElement) {
                if (hasAnyValue) {
                    const average = sum / 4;
                    averageElement.textContent = average.toFixed(1);
                    
                    const level = getProficiencyLevel(average);
                    levelElement.className = `px-6 py-3 rounded-2xl text-sm font-bold ${level.class}`;
                    levelElement.innerHTML = level.text;
                    
                    // Add approval status - only show if all 4 grades are filled
                    const allGradesFilled = filledGrades === 4;
                    const status = getApprovalStatus(average, allGradesFilled);
                    statusElement.className = `px-4 py-2 rounded-xl text-xs font-bold ${status.class}`;
                    statusElement.innerHTML = status.text;
                } else {
                    averageElement.textContent = '-';
                    levelElement.className = 'px-6 py-3 rounded-2xl text-sm font-bold bg-gray-200 text-gray-600';
                    levelElement.textContent = 'Aguardando notas';
                    statusElement.className = 'px-4 py-2 rounded-xl text-xs font-bold bg-gray-100 text-gray-500';
                    statusElement.textContent = '-';
                }
            }
        }

        function saveData() {
            try {
                const data = {
                    studentInfo: {
                        name: document.getElementById('studentName').value,
                        class: document.getElementById('studentClass').value,
                        lifeProject: document.getElementById('lifeProject').value
                    },
                    subjects: [],
                    subjectCount: subjectCount
                };

                // Collect all subjects data
                for (let i = 1; i <= subjectCount; i++) {
                    const subjectElement = document.getElementById(`subject-${i}`);
                    if (subjectElement) {
                        const nameInput = subjectElement.querySelector('input[type="text"]');
                        const gradeInputs = subjectElement.querySelectorAll('input[type="number"]');
                        
                        const subjectData = {
                            id: i,
                            name: nameInput ? nameInput.value : '',
                            grades: []
                        };

                        gradeInputs.forEach(input => {
                            subjectData.grades.push(input.value);
                        });

                        data.subjects.push(subjectData);
                    }
                }

                localStorage.setItem('calculaNotasData', JSON.stringify(data));
                
                // Show success message
                const originalText = document.getElementById('saveDataBtn').innerHTML;
                document.getElementById('saveDataBtn').innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>Salvo!</span>
                `;
                document.getElementById('saveDataBtn').className = 'bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-6 py-3 rounded-xl font-semibold flex items-center space-x-2 text-sm shadow-lg transition-all duration-300 hover:scale-105';
                
                setTimeout(() => {
                    document.getElementById('saveDataBtn').innerHTML = originalText;
                    document.getElementById('saveDataBtn').className = 'modern-btn text-white px-6 py-3 rounded-xl font-semibold flex items-center space-x-2 text-sm shadow-lg';
                }, 2000);

            } catch (error) {
                alert('Erro ao salvar os dados. Tente novamente.');
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('calculaNotasData');
                if (!savedData) return;

                const data = JSON.parse(savedData);

                // Load student info
                if (data.studentInfo) {
                    document.getElementById('studentName').value = data.studentInfo.name || '';
                    document.getElementById('studentClass').value = data.studentInfo.class || '';
                    document.getElementById('lifeProject').value = data.studentInfo.lifeProject || '';
                }

                // Load subjects
                if (data.subjects && data.subjects.length > 0) {
                    subjectCount = 0; // Reset counter
                    
                    data.subjects.forEach(subjectData => {
                        addSubject();
                        
                        const subjectElement = document.getElementById(`subject-${subjectCount}`);
                        if (subjectElement) {
                            const nameInput = subjectElement.querySelector('input[type="text"]');
                            const gradeInputs = subjectElement.querySelectorAll('input[type="number"]');
                            
                            if (nameInput) {
                                nameInput.value = subjectData.name || '';
                            }

                            gradeInputs.forEach((input, index) => {
                                if (subjectData.grades && subjectData.grades[index]) {
                                    input.value = subjectData.grades[index];
                                    // Update the level indicators
                                    updateBimesterLevel(subjectCount, index + 1, subjectData.grades[index]);
                                }
                            });

                            // Calculate average for this subject
                            calculateAverage(subjectCount);
                        }
                    });
                }

            } catch (error) {
                console.log('Erro ao carregar dados salvos:', error);
            }
        }

        function showCharts() {
            const modal = document.getElementById('chartsModal');
            if (modal) {
                modal.classList.remove('hidden');
                generateCharts();
            }
        }

        function closeCharts() {
            const modal = document.getElementById('chartsModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function printReport() {
            // Set print date
            const printDateElement = document.getElementById('printDate');
            if (printDateElement) {
                const now = new Date();
                printDateElement.textContent = now.toLocaleDateString('pt-BR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // Trigger print
            window.print();
        }

        function savePDF() {
            // Set print date
            const printDateElement = document.getElementById('printDate');
            if (printDateElement) {
                const now = new Date();
                printDateElement.textContent = now.toLocaleDateString('pt-BR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // Get student name for filename
            const studentName = document.getElementById('studentName').value || 'Aluno';
            const fileName = `Relatorio_${studentName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            
            // Show loading state
            const pdfBtn = document.getElementById('savePdfBtn');
            const originalContent = pdfBtn.innerHTML;
            pdfBtn.innerHTML = `
                <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <span>Gerando PDF...</span>
            `;
            pdfBtn.disabled = true;
            
            // Use browser's print to PDF functionality
            setTimeout(() => {
                // Create a temporary message for the user
                const tempDiv = document.createElement('div');
                tempDiv.className = 'fixed top-4 right-4 bg-blue-600 text-white px-6 py-4 rounded-lg shadow-lg z-50';
                tempDiv.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <div class="font-semibold">Para salvar como PDF:</div>
                            <div class="text-sm">Use Ctrl+P e selecione "Salvar como PDF" no destino</div>
                        </div>
                    </div>
                `;
                document.body.appendChild(tempDiv);
                
                // Trigger print dialog
                window.print();
                
                // Remove message after 5 seconds
                setTimeout(() => {
                    if (tempDiv.parentNode) {
                        tempDiv.parentNode.removeChild(tempDiv);
                    }
                }, 5000);
                
                // Restore button
                pdfBtn.innerHTML = originalContent;
                pdfBtn.disabled = false;
            }, 500);
        }

        function generateCharts() {
            // Collect current data
            const studentData = {
                name: document.getElementById('studentName').value || 'Aluno',
                class: document.getElementById('studentClass').value || '-',
                lifeProject: document.getElementById('lifeProject').value || '-'
            };

            const subjects = [];
            let totalAverage = 0;
            let validSubjectCount = 0;

            // Get all subject containers that exist - improved selector
            for (let i = 1; i <= subjectCount; i++) {
                const subjectElement = document.getElementById(`subject-${i}`);
                if (subjectElement) {
                    const nameInput = subjectElement.querySelector('input[type="text"]');
                    const gradeInputs = subjectElement.querySelectorAll('input[type="number"]');
                    
                    const subjectName = nameInput ? nameInput.value.trim() : '';
                    
                    if (subjectName) { // Only process subjects with names
                        const grades = [];
                        let sum = 0;
                        let gradeCount = 0;
                        let hasValidGrades = false;

                        gradeInputs.forEach(input => {
                            const inputValue = input.value.trim();
                            if (inputValue !== '') {
                                const value = parseFloat(inputValue);
                                if (!isNaN(value) && value >= 0) {
                                    grades.push(value);
                                    sum += value;
                                    gradeCount++;
                                    hasValidGrades = true;
                                } else {
                                    grades.push(0);
                                }
                            } else {
                                grades.push(0);
                            }
                        });

                        // Calculate average (divide by 4 always, but only count if has valid grades)
                        const average = hasValidGrades ? sum / 4 : 0;
                        
                        subjects.push({
                            name: subjectName,
                            grades: grades,
                            average: average,
                            hasData: hasValidGrades,
                            validGradeCount: gradeCount
                        });
                        
                        if (hasValidGrades) {
                            totalAverage += average;
                            validSubjectCount++;
                        }
                    }
                }
            }

            const overallAverage = validSubjectCount > 0 ? totalAverage / validSubjectCount : 0;

            // Update student info in modal
            document.getElementById('chartStudentName').textContent = studentData.name;
            document.getElementById('chartStudentClass').textContent = studentData.class;
            document.getElementById('chartOverallAverage').textContent = overallAverage.toFixed(1);

            // Generate charts
            generateSubjectsChart(subjects);
            generateProficiencyChart(subjects);
            generateEvolutionChart(subjects);
            generateIndividualCharts(subjects);
            generateRecommendations(subjects, overallAverage);
        }

        function generateSubjectsChart(subjects) {
            const container = document.getElementById('subjectsChart');
            if (!container) return;
            
            if (subjects.length === 0) {
                container.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><div class="text-center"><div class="text-4xl mb-2">üìä</div><div>Adicione disciplinas e notas para ver os gr√°ficos</div></div></div>';
                return;
            }

            let html = '<div class="space-y-4">';
            
            subjects.forEach(subject => {
                const percentage = subject.hasData ? (subject.average / 10) * 100 : 0;
                const color = subject.hasData ? getColorByGrade(subject.average) : 'bg-gray-300';
                const displayAverage = subject.hasData ? subject.average.toFixed(1) : '-';
                
                html += `
                    <div class="flex items-center justify-between">
                        <div class="flex-1 mr-4">
                            <div class="text-sm font-medium text-gray-300 mb-1">${subject.name}</div>
                            <div class="w-full bg-gray-700 rounded-full h-4">
                                <div class="h-4 rounded-full ${color} transition-all duration-500" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="text-lg font-bold text-white min-w-[3rem] text-right">
                            ${displayAverage}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function generateProficiencyChart(subjects) {
            const container = document.getElementById('proficiencyChart');
            if (!container) return;
            
            const subjectsWithData = subjects.filter(s => s.hasData);
            
            if (subjectsWithData.length === 0) {
                container.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><div class="text-center"><div class="text-4xl mb-2">üìà</div><div>Adicione notas para ver a distribui√ß√£o de n√≠veis</div></div></div>';
                return;
            }

            const levels = {
                'Abaixo do B√°sico': { count: 0, color: 'bg-red-500', emoji: 'üòû' },
                'B√°sico': { count: 0, color: 'bg-orange-500', emoji: 'üòê' },
                'Adequado': { count: 0, color: 'bg-yellow-500', emoji: 'üòä' },
                'Avan√ßado': { count: 0, color: 'bg-green-500', emoji: 'üéâ' }
            };

            subjectsWithData.forEach(subject => {
                const percentage = (subject.average / 10) * 100;
                if (percentage < 50) levels['Abaixo do B√°sico'].count++;
                else if (percentage < 70) levels['B√°sico'].count++;
                else if (percentage < 80) levels['Adequado'].count++;
                else levels['Avan√ßado'].count++;
            });

            const total = subjectsWithData.length;
            let html = '<div class="space-y-4">';

            Object.entries(levels).forEach(([level, data]) => {
                const percentage = total > 0 ? (data.count / total) * 100 : 0;
                html += `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center flex-1 mr-4">
                            <span class="text-2xl mr-3">${data.emoji}</span>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-300 mb-1">${level}</div>
                                <div class="w-full bg-gray-700 rounded-full h-4">
                                    <div class="h-4 rounded-full ${data.color} transition-all duration-500" style="width: ${percentage}%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="text-lg font-bold text-white min-w-[3rem] text-right">
                            ${data.count}
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function generateEvolutionChart(subjects) {
            const container = document.getElementById('evolutionChart');
            if (!container) return;
            
            const subjectsWithData = subjects.filter(s => s.hasData);
            
            if (subjectsWithData.length === 0) {
                container.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><div class="text-center"><div class="text-4xl mb-2">üìä</div><div>Adicione notas em diferentes bimestres para ver a evolu√ß√£o</div></div></div>';
                return;
            }

            // Calculate average per bimester
            const bimesterAverages = [0, 0, 0, 0];
            const bimesterCounts = [0, 0, 0, 0];

            subjectsWithData.forEach(subject => {
                subject.grades.forEach((grade, index) => {
                    if (grade > 0) {
                        bimesterAverages[index] += grade;
                        bimesterCounts[index]++;
                    }
                });
            });

            // Calculate final averages
            const finalAverages = bimesterAverages.map((sum, index) => 
                bimesterCounts[index] > 0 ? sum / bimesterCounts[index] : 0
            );

            let html = '<div class="space-y-6">';
            
            // Modern 3D-style bar chart with gradients and shadows
            html += '<div class="relative bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-gray-700">';
            html += '<div class="flex items-end justify-between h-56 relative">';
            
            // Grid lines for better visualization
            for (let i = 0; i <= 10; i += 2) {
                const gridY = (i / 10) * 200;
                html += `<div class="absolute w-full border-t border-gray-600 opacity-30" style="bottom: ${gridY + 24}px;"></div>`;
            }
            
            finalAverages.forEach((avg, index) => {
                const height = avg > 0 ? Math.max((avg / 10) * 200, 24) : 24;
                const displayAvg = avg > 0 ? avg.toFixed(1) : '-';
                
                // Modern gradient colors based on performance
                let gradientClass = 'from-gray-400 to-gray-500';
                let shadowColor = 'shadow-gray-400/30';
                let glowClass = '';
                
                if (avg > 0) {
                    const percentage = (avg / 10) * 100;
                    if (percentage >= 80) {
                        gradientClass = 'from-emerald-400 to-emerald-600';
                        shadowColor = 'shadow-emerald-400/40';
                        glowClass = 'shadow-emerald-400/20 shadow-lg';
                    } else if (percentage >= 70) {
                        gradientClass = 'from-yellow-400 to-yellow-600';
                        shadowColor = 'shadow-yellow-400/40';
                        glowClass = 'shadow-yellow-400/20 shadow-lg';
                    } else if (percentage >= 50) {
                        gradientClass = 'from-orange-400 to-orange-600';
                        shadowColor = 'shadow-orange-400/40';
                        glowClass = 'shadow-orange-400/20 shadow-lg';
                    } else {
                        gradientClass = 'from-red-400 to-red-600';
                        shadowColor = 'shadow-red-400/40';
                        glowClass = 'shadow-red-400/20 shadow-lg';
                    }
                }
                
                html += `
                    <div class="flex flex-col items-center flex-1 mx-1 group cursor-pointer">
                        <!-- Value display on hover -->
                        <div class="opacity-0 group-hover:opacity-100 transition-all duration-300 transform -translate-y-2 group-hover:translate-y-0 mb-2">
                            <div class="bg-gray-800 text-white px-3 py-1 rounded-lg text-sm font-semibold shadow-lg">
                                ${displayAvg}
                            </div>
                        </div>
                        
                        <!-- Modern 3D column -->
                        <div class="relative w-full flex justify-center mb-3">
                            <div class="w-16 bg-gradient-to-t ${gradientClass} rounded-t-lg ${shadowColor} shadow-xl transform transition-all duration-500 hover:scale-105 hover:-translate-y-1 ${glowClass} relative overflow-hidden" 
                                 style="height: ${height}px;">
                                <!-- Shine effect -->
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
                                <!-- Top highlight -->
                                <div class="absolute top-0 left-0 right-0 h-2 bg-white/30 rounded-t-lg"></div>
                            </div>
                        </div>
                        
                        <!-- Labels -->
                        <div class="text-center">
                            <div class="text-sm font-semibold text-gray-300 mb-1">${index + 1}¬∫ Bimestre</div>
                            <div class="text-lg font-bold text-white">${displayAvg}</div>
                            <div class="text-xs text-gray-400 bg-gray-700 px-2 py-1 rounded-full">
                                ${bimesterCounts[index]} ${bimesterCounts[index] === 1 ? 'nota' : 'notas'}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            html += '</div>';

            // Modern evolution summary with cards
            const validAverages = finalAverages.filter(avg => avg > 0);
            if (validAverages.length >= 2) {
                const firstValid = validAverages[0];
                const lastValid = validAverages[validAverages.length - 1];
                const trend = lastValid - firstValid;
                const trendText = trend > 0.5 ? 'Tend√™ncia de Melhoria' : trend < -0.5 ? 'Tend√™ncia de Decl√≠nio' : 'Desempenho Est√°vel';
                
                let trendColor, trendBg, trendIcon, trendBorder;
                if (trend > 0.5) {
                    trendColor = 'text-emerald-300';
                    trendBg = 'bg-emerald-500/20';
                    trendBorder = 'border-emerald-500/30';
                    trendIcon = 'üìà';
                } else if (trend < -0.5) {
                    trendColor = 'text-red-300';
                    trendBg = 'bg-red-500/20';
                    trendBorder = 'border-red-500/30';
                    trendIcon = 'üìâ';
                } else {
                    trendColor = 'text-blue-300';
                    trendBg = 'bg-blue-500/20';
                    trendBorder = 'border-blue-500/30';
                    trendIcon = '‚û°Ô∏è';
                }

                html += `
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="${trendBg} ${trendBorder} border rounded-xl p-4 text-center">
                            <div class="text-3xl mb-2">${trendIcon}</div>
                            <div class="text-lg font-bold ${trendColor}">${trendText}</div>
                            <div class="text-sm text-gray-400 mt-1">
                                ${Math.abs(trend).toFixed(1)} pontos de varia√ß√£o
                            </div>
                        </div>
                        
                        <div class="bg-purple-500/20 border border-purple-500/30 rounded-xl p-4 text-center">
                            <div class="text-3xl mb-2">üéØ</div>
                            <div class="text-lg font-bold text-purple-300">M√©dia Atual</div>
                            <div class="text-2xl font-bold text-purple-200">${(validAverages.reduce((a, b) => a + b, 0) / validAverages.length).toFixed(1)}</div>
                        </div>
                        
                        <div class="bg-indigo-500/20 border border-indigo-500/30 rounded-xl p-4 text-center">
                            <div class="text-3xl mb-2">üìä</div>
                            <div class="text-lg font-bold text-indigo-300">Bimestres Avaliados</div>
                            <div class="text-2xl font-bold text-indigo-200">${validAverages.length}/4</div>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="bg-gray-800 border border-gray-700 rounded-xl p-8 text-center">
                        <div class="text-4xl mb-4">üìä</div>
                        <div class="text-xl font-bold text-gray-300 mb-2">Dados Insuficientes</div>
                        <div class="text-gray-400">
                            Adicione notas em pelo menos 2 bimestres para visualizar a evolu√ß√£o do desempenho
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function generateIndividualCharts(subjects) {
            const container = document.getElementById('individualChartsContainer');
            if (!container) return;
            
            const subjectsWithData = subjects.filter(s => s.hasData);
            
            if (subjectsWithData.length === 0) {
                container.innerHTML = '<div class="col-span-full flex items-center justify-center h-32 text-gray-400"><div class="text-center"><div class="text-3xl mb-2">üìö</div><div>Adicione disciplinas com notas para ver gr√°ficos individuais</div></div></div>';
                return;
            }

            let html = `
                <div class="col-span-full mb-6">
                    <h3 class="text-2xl font-semibold text-white flex items-center">
                        <div class="bg-gradient-to-br from-indigo-400 to-purple-600 p-3 rounded-lg mr-4 icon-glow">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        Evolu√ß√£o Individual por Disciplina
                    </h3>
                </div>
            `;
            
            subjectsWithData.forEach((subject, index) => {
                const maxGrade = Math.max(...subject.grades.filter(g => g > 0));
                const minGrade = Math.min(...subject.grades.filter(g => g > 0));
                const validMinGrade = minGrade === Infinity ? 0 : minGrade;
                
                html += `
                    <div class="chart-container rounded-lg p-4">
                        <div class="text-center mb-3">
                            <h4 class="text-sm font-semibold text-white truncate" title="${subject.name}">${subject.name}</h4>
                            <div class="text-lg font-bold text-indigo-400">${subject.average.toFixed(1)}</div>
                        </div>
                        
                        <!-- Modern Mini bar chart -->
                        <div class="relative bg-gradient-to-br from-gray-800 to-gray-900 rounded-lg p-3 mb-3">
                            <div class="flex items-end justify-between h-16 relative">
                `;
                
                subject.grades.forEach((grade, bimIndex) => {
                    const height = grade > 0 ? Math.max((grade / 10) * 48, 6) : 6;
                    const displayGrade = grade > 0 ? grade.toFixed(1) : '-';
                    
                    // Modern gradient colors
                    let gradientClass = 'from-gray-300 to-gray-400';
                    let shadowClass = 'shadow-gray-300/50';
                    
                    if (grade > 0) {
                        const percentage = (grade / 10) * 100;
                        if (percentage >= 80) {
                            gradientClass = 'from-emerald-400 to-emerald-500';
                            shadowClass = 'shadow-emerald-400/50';
                        } else if (percentage >= 70) {
                            gradientClass = 'from-yellow-400 to-yellow-500';
                            shadowClass = 'shadow-yellow-400/50';
                        } else if (percentage >= 50) {
                            gradientClass = 'from-orange-400 to-orange-500';
                            shadowClass = 'shadow-orange-400/50';
                        } else {
                            gradientClass = 'from-red-400 to-red-500';
                            shadowClass = 'shadow-red-400/50';
                        }
                    }
                    
                    html += `
                        <div class="flex flex-col items-center flex-1 mx-0.5 group">
                            <!-- Hover tooltip -->
                            <div class="opacity-0 group-hover:opacity-100 transition-all duration-200 transform -translate-y-1 group-hover:translate-y-0 mb-1">
                                <div class="bg-gray-800 text-white px-2 py-1 rounded text-xs font-medium shadow-lg whitespace-nowrap">
                                    ${displayGrade}
                                </div>
                            </div>
                            
                            <!-- Modern 3D mini column -->
                            <div class="w-3 bg-gradient-to-t ${gradientClass} rounded-t ${shadowClass} shadow-md transform transition-all duration-300 hover:scale-110 hover:-translate-y-0.5 relative overflow-hidden" 
                                 style="height: ${height}px;">
                                <!-- Shine effect -->
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-500"></div>
                                <!-- Top highlight -->
                                <div class="absolute top-0 left-0 right-0 h-0.5 bg-white/40 rounded-t"></div>
                            </div>
                            
                            <div class="text-xs text-gray-400 mt-1 font-medium">${bimIndex + 1}¬∫</div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                        
                        <!-- Mini stats -->
                        <div class="grid grid-cols-2 gap-2 text-center text-xs">
                            <div>
                                <div class="text-gray-400">Maior</div>
                                <div class="font-bold text-green-400">${maxGrade > 0 ? maxGrade.toFixed(1) : '-'}</div>
                            </div>
                            <div>
                                <div class="text-gray-400">Menor</div>
                                <div class="font-bold text-red-400">${validMinGrade > 0 ? validMinGrade.toFixed(1) : '-'}</div>
                            </div>
                        </div>
                        
                        <!-- Level indicator -->
                        <div class="mt-3 text-center">
                            <div class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getColorByGrade(subject.average)} text-white">
                                ${getProficiencyLevelText(subject.average)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function getProficiencyLevelText(grade) {
            const percentage = (grade / 10) * 100;
            if (percentage < 50) return 'Abaixo do B√°sico üòû';
            if (percentage < 70) return 'B√°sico üòê';
            if (percentage < 80) return 'Adequado üòä';
            return 'Avan√ßado üéâ';
        }

        function generateRecommendations(subjects, overallAverage) {
            const container = document.getElementById('recommendations');
            if (!container) return;

            let recommendations = [];

            // Overall performance
            if (overallAverage >= 8) {
                recommendations.push('üéâ Excelente desempenho! Continue mantendo esse ritmo de estudos.');
            } else if (overallAverage >= 7) {
                recommendations.push('üòä Bom desempenho! Foque em melhorar as disciplinas com notas mais baixas.');
            } else if (overallAverage >= 5) {
                recommendations.push('üòê Desempenho regular. Organize melhor seus estudos e dedique mais tempo √†s mat√©rias.');
            } else {
                recommendations.push('üòû Aten√ß√£o! √â necess√°rio um plano de estudos mais intensivo para melhorar as notas.');
            }

            // Subject-specific recommendations
            const weakSubjects = subjects.filter(s => s.average < 6);
            const strongSubjects = subjects.filter(s => s.average >= 8);

            if (weakSubjects.length > 0) {
                recommendations.push(`üìö Foque especialmente em: ${weakSubjects.map(s => s.name).join(', ')}`);
            }

            if (strongSubjects.length > 0) {
                recommendations.push(`‚≠ê Pontos fortes: ${strongSubjects.map(s => s.name).join(', ')}`);
            }

            // Study tips
            recommendations.push('üí° Dica: Revise regularmente o conte√∫do e fa√ßa resumos das mat√©rias.');
            recommendations.push('‚è∞ Organize um cronograma de estudos distribuindo o tempo entre todas as disciplinas.');

            const html = recommendations.map(rec => `<div class="mb-2 p-3 bg-yellow-500/20 rounded-lg border border-yellow-500/30">${rec}</div>`).join('');
            container.innerHTML = html;
        }

        function getColorByGrade(grade) {
            const percentage = (grade / 10) * 100;
            if (percentage < 50) return 'bg-red-500';
            if (percentage < 70) return 'bg-orange-500';
            if (percentage < 80) return 'bg-yellow-500';
            return 'bg-green-500';
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('chartsModal');
            if (event.target === modal) {
                closeCharts();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97a68db1f127cb51',t:'MTc1NzA4Mzk3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
